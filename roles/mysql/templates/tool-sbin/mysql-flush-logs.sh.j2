#!/usr/bin/env bash

ts=$(/bin/date '+%Y.%m.%d.%s')

# 处理通用日志
if [ -f {{ data_dir }}/general.log ]; then
    /usr/bin/mv {{ data_dir }}/general.log {{ data_dir }}/general.log."$ts"
    {{ install_dir }}/bin/mysql -e "FLUSH GENERAL LOGS;"
fi

# 处理错误日志
if [ -f {{ data_dir }}/error.log ]; then
    /usr/bin/mv {{ data_dir }}/error.log {{ data_dir }}/error.log."$ts"
    {{ install_dir }}/bin/mysql -e "FLUSH ERROR LOGS;"
fi

# 处理慢查询日志
if [ -f {{ data_dir }}/slow.log ]; then
    /usr/bin/mv {{ data_dir }}/slow.log {{ data_dir }}/slow.log."$ts"
    {{ install_dir }}/bin/mysql -e "FLUSH SLOW LOGS;"
fi
